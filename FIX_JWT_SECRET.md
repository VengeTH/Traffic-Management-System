# üîê Fix Missing JWT_REFRESH_SECRET

## Problem
Server won't start because `JWT_REFRESH_SECRET` is missing from your `.env` file.

## Solution: Add JWT_REFRESH_SECRET to .env

### Step 1: Generate a Secure JWT Secret

On your Ubuntu server, run:

```bash
# Generate a secure random secret (32+ characters)
openssl rand -base64 32
```

This will output something like: `xK9mP2qR5vT8wY3zA6bC9dE1fG4hI7jK0lM3nO6pQ9rS2tU5vW8xY1zA4bC7dE0fG`

### Step 2: Edit Your .env File

```bash
cd ~/Traffic-Management-System
nano .env
```

### Step 3: Add or Update JWT Secrets

Find these lines in your `.env` file:

```env
JWT_SECRET=your_super_secret_jwt_key_here_make_it_long_and_random_minimum_32_characters
JWT_REFRESH_SECRET=your_refresh_token_secret_here_minimum_32_characters
```

**Replace them with your generated secrets:**

```env
JWT_SECRET=xK9mP2qR5vT8wY3zA6bC9dE1fG4hI7jK0lM3nO6pQ9rS2tU5vW8xY1zA4bC7dE0fG
JWT_REFRESH_SECRET=yL0nQ3rS6wU9xZ2aB5cD8eF1gH4iJ7kL0mN3oP6qR9sT2uV5wX8yZ1aB4cD7eF0gH
```

**Important:**
- Use DIFFERENT secrets for JWT_SECRET and JWT_REFRESH_SECRET
- Each secret must be at least 32 characters long
- Use the secrets generated by `openssl rand -base64 32`

### Step 4: Save and Exit

Press:
- `Ctrl+X` to exit
- `Y` to save
- `Enter` to confirm

### Step 5: Restart Server

Nodemon should auto-restart, but if not:

```bash
# The server should restart automatically with nodemon
# If not, press Ctrl+C and run:
npm run dev
```

## Quick One-Liner to Generate Both Secrets

```bash
# Generate JWT_SECRET
echo "JWT_SECRET=$(openssl rand -base64 32)"

# Generate JWT_REFRESH_SECRET  
echo "JWT_REFRESH_SECRET=$(openssl rand -base64 32)"
```

## Verify Your .env File

After editing, verify the secrets are there:

```bash
cat .env | grep JWT
```

You should see:
```
JWT_SECRET=... (long random string)
JWT_REFRESH_SECRET=... (long random string, different from JWT_SECRET)
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d
```

## After Adding Secrets

Once you've added the secrets and saved the file, nodemon should automatically restart the server. You should see:

```
üöÄ E-VioPay server running on port 5000
üìä Environment: production
üîó Health check: http://localhost:5000/health
üì± API Base URL: http://localhost:5000/api
üåê Server accessible from: http://0.0.0.0:5000
```

Then test:
```bash
curl http://localhost:5000/health
```

